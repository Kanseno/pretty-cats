  on:
    workflow_dispatch:  # Enables manual trigger from GitHub UI

  jobs:
    build:
      runs-on: ubuntu-latest
      environment: production
      env:
        CAT_API_KEY: ${{ secrets.CAT_API_KEY }}

      steps:
        - uses: actions/checkout@v4

        - name: Use Node
          uses: actions/setup-node@v4
          with:
            node-version: 20

        - name: Install deps
          run: npm ci

        - name: Inject env file with secret
          run: |
            cat > src/environments/environment.production.ts << 'EOF'
            export const environment = {
              production: true,
              catApiKey: '${CAT_API_KEY}',
            };
            EOF

        - name: Build Angular
          run: npm run build -- --configuration=production
